---
## Author
author:
  name: Чамочумби Аксель
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6


## Title
title: "Отчёт по лобораторной работе №5"
subtitle: "Основы работы с Midnight Commander (mc). Структура программы на языке ассемблера NASM. Системные вызовы в ОС GNU Linux"
license: "CC BY"
--- 


# Цель работы

Приобретение практических навыков работы в Midnight Commander. Освоение инструкций
языка ассемблера mov и int.

# Выполнение лабораторной работы

1. Запуск Midnight Commander для работы с файлами([рис. @fig-001]).

![Вводим в консоль программу mc](image/1.png){#fig-001 width=70%}

2. Перейдем в созданный при выполнении 4 лабораторной работы каталог ([рис. @fig-002])

![Перемещение в каталог](image/2.png){#fig-002 width=70%}

3. С помощью функциональной клавиши F7 создадим папку lab05 ([рис. @fig-003]) и перейдем
в созданный каталог ([рис. @fig-004]).

![Создание каталога](image/3.png){#fig-003 width=70%}

![Переход в каталог lab05 с момощью клавиши Enter](image/4.png){#fig-004 width=70%}

4. Пользуясь строкой ввода и командой touch создадим файл lab5-1.asm ([рис. @fig-005]).

![Создание файла](image/5.png){#fig-005 width=70%}

5. С помощью функциональной клавиши F4 откроем файл lab5-1.asm для редактирова-
ния во встроенном редакторе nano и введем текст программы из листинга 5.1, сохраним изменения и закроем файл ([рис. @fig-006]). 

![Открываем файл во встроенном редакторе](image/6.png){#fig-006 width=70%}

6. Листинг 5.1

```nasm

;------------------------------------------------------------------
; Программа вывода сообщения на экран и ввода строки с клавиатуры
;------------------------------------------------------------------
;------------------- Объявление переменных ----------------
SECTION .data
msg: DB 'Введите строку:',10
msgLen: EQU $-msg
SECTION .bss
buf1: RESB 80
;------------------- Текст программы -----------------
SECTION .text
GLOBAL _start
_start:

;------------ Cистемный вызов `write`
mov eax, 4
mov ebx, 1
mov ecx, msg
mov edx, msgLen
int 80h

;------------ системный вызов `read` ----------------------
mov eax, 3
mov ebx, 0
mov ecx, buf1
mov edx, 80
int 80h

;------------ Системный вызов `exit` ----------------------
mov eax, 1
mov ebx, 0
int 80h

```

7. С помощью функциональной клавиши F3 откроем файл lab5-1.asm для просмотра. Убедимся, что файл содержит текст программы. ([рис. @fig-007]). 

![Проверяем, что файл содержит текст программы](image/7.png){#fig-007 width=70%}

8. Оттранслируем текст программы lab5-1.asm в объектный файл. Выполним компоновку объектного файла и запустим получившийся исполняемый файл. ([рис. @fig-008]). 

![Запуск программы](image/8.png){#fig-008 width=70%}

9. Скачаем файл in_out.asm со страницы курса в ТУИС.

10. Скопируем файл in_out.asm в каталог с файлом lab5-1.asm с помощью функциональной
клавиши F5 ([рис. @fig-009]). 

![Копирование файла in_out.asm](image/9.png){#fig-009 width=70%}

11. С помощью функциональной клавиши F5 создадим копию файла lab5-1.asm с именем lab5-2.asm ([рис. @fig-010]). 

![Копирование файла lab5-1.asm](image/10.png){#fig-010 width=70%}

12. Исправим текст программы в файле lab5-2.asm с использование подпрограмм из
внешнего файла in_out.asm (используем подпрограммы sprintLF, sread и quit) в
соответствии с листингом 5.2 ([рис. @fig-011]). Создадим исполняемый файл и проверим его работу ([рис. @fig-012]).

![Редактируем программу](image/11.png){#fig-011 width=70%}

![Запуск программы](image/12.png){#fig-012 width=70%}

Листинг 5.2
 
```nasm

;------------------------------------------------------------------
; Программа вывода сообщения на экран и ввода строки с клавиатуры
;------------------------------------------------------------------
;-------------------- Объявление переменных ----------------
%include 'in_out.asm'
SECTION .data                ; Секция инициированных данных
msg: DB 'Введите строку:',10 ; сообщение плюс
; символ перевода строки
msgLen: EQU $-msg            ; Длина переменной 'msg'
SECTION .bss                 ; Секция не инициированных данных
buf1: RESB 80                ; Буфер размером 80 байт
;------------------- Текст программы -----------------
SECTION .text                ; Код программы
GLOBAL _start                ; Начало программы
_start:                      ; Точка входа в программу

mov eax, msg
call sprint
mov ecx, buf1
mov edx, 80
call sread
call quit

```

13. В файле lab5-2.asm заменим подпрограмму sprintLF на sprint. Создадим исполняемый файл и проверим его работу ([рис. @fig-013]). 

![Запуск измененной программы](image/13.png){#fig-013 width=70%}

Сравнив результаты понимаем, что подпрограмма sprintLF, в отличие от sprint, содержит символ перевода строки, поэтоу при вводе появляемтся пустая строка.

# Задание для самостоятельной работы

1. Создадим копию файла lab5-1.asm ([рис. @fig-014]). Внесем изменения в программу (без использования внешнего файла in_out.asm), так чтобы она работала по следующему алгоритму:

• вывести приглашение типа “Введите строку:”

• ввести строку с клавиатуры

• вывести введённую строку на экран.([рис. @fig-015]). 

![Создание копии файла](image/14.png){#fig-014 width=70%}

![Текст программы](image/15.png){#fig-015 width=70%}

Листинг lab5-11.asm

```nasm

;----------------------------------------------------------------
; Программа вывода сообщения, ввода строки и её повторного вывода
;------------------------------------------------------------------
;------------------- Объявление переменных ----------------
SECTION .data
msg: DB 'Введите строку:',10
msgLen: EQU $-msg
SECTION .bss
buf1: RESB 80
;------------------- Текст программы -----------------
SECTION .text
GLOBAL _start
_start:

;------------ Cистемный вызов `write`
mov eax, 4
mov ebx, 1
mov ecx, msg
mov edx, msgLen
int 80h

;------------ системный вызов `read` ----------------------
mov eax, 3
mov ebx, 0
mov ecx, buf1
mov edx, 80
int 80h

; --- Выводим введённую строку ---
mov eax, 4
mov ebx, 1
mov ecx, buf1
mov edx, 80
int 80h

;------------ Системный вызов `exit` ----------------------
mov eax, 1
mov ebx, 0
int 80h

```

2. Получите исполняемый файл и проверьте его работу ([рис. @fig-016]). 

![Проверяем работу программы](image/16.png){#fig-016 width=70%}

3. Создадим копию файла lab5-2.asm ([рис. @fig-017]). Исправим текст программы с использование подпрограмм из внешнего файла in_out.asm, так чтобы она работала по следующему
алгоритму:

• вывести приглашение типа “Введите строку:”

• ввести строку с клавиатуры

• вывести введённую строку на экран. ([рис. @fig-018]). 

![Создание копии файла](image/17.png){#fig-017 width=70%}

![Текст программы](image/18.png){#fig-018 width=70%}

Листинг lab5-22.asm

```nasm

;------------------------------------------------------------------
; Программа вывода сообщения на экран и ввода строки с клавиатуры
;------------------------------------------------------------------
;-------------------- Объявление переменных ----------------
%include 'in_out.asm'
SECTION .data                ; Секция инициированных данных
msg: DB 'Введите строку:',10 ; сообщение плюс
; символ перевода строки
msgLen: EQU $-msg            ; Длина переменной 'msg'
SECTION .bss                 ; Секция не инициированных данных
buf1: RESB 80                ; Буфер размером 80 байт
;------------------- Текст программы -----------------
SECTION .text       ; Код программы
GLOBAL _start       ; Начало программы
_start:             ; Точка входа в программу

mov eax, msg
call sprint
mov ecx, buf1
mov edx, 80
call sread
mov eax,buf1
call sprint
call quit

```

4. Создадим исполняемый файл и проверим его работу. ([рис. @fig-019]). 

![Выполнение компановки файла](image/19.png){#fig-019 width=70%}

# Выводы

Мы приобрели навыки работы с Midnight Commander и создали несколько работающих
программ. Освоили инструкции mov и int.
